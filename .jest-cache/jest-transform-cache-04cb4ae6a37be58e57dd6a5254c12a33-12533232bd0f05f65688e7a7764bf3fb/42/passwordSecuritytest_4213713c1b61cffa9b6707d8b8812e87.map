{"version":3,"sources":["D:\\Tech Vitta\\Apps\\DEMO\\__tests__\\lib\\passwordSecurity.test.js"],"sourcesContent":["/**\r\n * Password Security Tests\r\n * Tests for password hashing, verification, and rate limiting\r\n */\r\n\r\nimport { \r\n  hashPassword, \r\n  verifyPassword, \r\n  validatePasswordStrength, \r\n  isSecureHash,\r\n  loginRateLimiter \r\n} from '@/lib/passwordSecurity';\r\n\r\n// Mock crypto for testing\r\nglobal.crypto = {\r\n  getRandomValues: (arr) => {\r\n    // Return predictable values for testing\r\n    for (let i = 0; i < arr.length; i++) {\r\n      arr[i] = i % 256;\r\n    }\r\n    return arr;\r\n  },\r\n  subtle: {\r\n    importKey: async (format, keyData, algorithm, extractable, keyUsages) => {\r\n      return { format, keyData, algorithm, extractable, keyUsages };\r\n    },\r\n    deriveBits: async (algorithm, keyMaterial, length) => {\r\n      // Return predictable hash for testing\r\n      const hash = new Uint8Array(length / 8);\r\n      for (let i = 0; i < hash.length; i++) {\r\n        hash[i] = (i * 7) % 256;\r\n      }\r\n      return hash.buffer;\r\n    }\r\n  }\r\n};\r\n\r\ndescribe('Password Security', () => {\r\n  describe('hashPassword', () => {\r\n    it('should hash a password successfully', async () => {\r\n      const password = 'TestPassword123';\r\n      const hash = await hashPassword(password);\r\n      \r\n      expect(hash).toBeDefined();\r\n      expect(typeof hash).toBe('string');\r\n      expect(hash.includes(':')).toBe(true);\r\n    });\r\n\r\n    it('should throw error for empty password', async () => {\r\n      await expect(hashPassword('')).rejects.toThrow();\r\n    });\r\n\r\n    it('should throw error for non-string password', async () => {\r\n      await expect(hashPassword(null)).rejects.toThrow();\r\n      await expect(hashPassword(123)).rejects.toThrow();\r\n    });\r\n  });\r\n\r\n  describe('verifyPassword', () => {\r\n    it('should verify correct password', async () => {\r\n      const password = 'TestPassword123';\r\n      const hash = await hashPassword(password);\r\n      const isValid = await verifyPassword(password, hash);\r\n      \r\n      expect(isValid).toBe(true);\r\n    });\r\n\r\n    it('should reject incorrect password', async () => {\r\n      const password = 'TestPassword123';\r\n      const hash = await hashPassword(password);\r\n      const isValid = await verifyPassword('WrongPassword', hash);\r\n      \r\n      expect(isValid).toBe(false);\r\n    });\r\n\r\n    it('should handle plain text passwords (backward compatibility)', async () => {\r\n      const password = 'plaintext123';\r\n      const isValid = await verifyPassword(password, password);\r\n      \r\n      expect(isValid).toBe(true);\r\n    });\r\n\r\n    it('should return false for empty inputs', async () => {\r\n      expect(await verifyPassword('', 'hash')).toBe(false);\r\n      expect(await verifyPassword('password', '')).toBe(false);\r\n      expect(await verifyPassword('', '')).toBe(false);\r\n    });\r\n  });\r\n\r\n  describe('validatePasswordStrength', () => {\r\n    it('should accept strong passwords', () => {\r\n      const result = validatePasswordStrength('StrongPass123');\r\n      expect(result.isValid).toBe(true);\r\n    });\r\n\r\n    it('should reject passwords shorter than 8 characters', () => {\r\n      const result = validatePasswordStrength('Short1');\r\n      expect(result.isValid).toBe(false);\r\n      expect(result.message).toContain('8 characters');\r\n    });\r\n\r\n    it('should reject passwords without numbers', () => {\r\n      const result = validatePasswordStrength('NoNumbers');\r\n      expect(result.isValid).toBe(false);\r\n      expect(result.message).toContain('number');\r\n    });\r\n\r\n    it('should reject passwords without letters', () => {\r\n      const result = validatePasswordStrength('12345678');\r\n      expect(result.isValid).toBe(false);\r\n      expect(result.message).toContain('letter');\r\n    });\r\n\r\n    it('should reject passwords longer than 128 characters', () => {\r\n      const longPassword = 'a'.repeat(129) + '1';\r\n      const result = validatePasswordStrength(longPassword);\r\n      expect(result.isValid).toBe(false);\r\n      expect(result.message).toContain('128 characters');\r\n    });\r\n\r\n    it('should reject empty passwords', () => {\r\n      const result = validatePasswordStrength('');\r\n      expect(result.isValid).toBe(false);\r\n      expect(result.message).toContain('required');\r\n    });\r\n  });\r\n\r\n  describe('isSecureHash', () => {\r\n    it('should identify secure hash format', () => {\r\n      expect(isSecureHash('salt:hash')).toBe(true);\r\n      expect(isSecureHash('abc123:def456')).toBe(true);\r\n    });\r\n\r\n    it('should reject plain text as secure hash', () => {\r\n      expect(isSecureHash('plaintext')).toBe(false);\r\n      expect(isSecureHash('password123')).toBe(false);\r\n    });\r\n\r\n    it('should handle invalid formats', () => {\r\n      expect(isSecureHash('')).toBe(false);\r\n      expect(isSecureHash(null)).toBe(false);\r\n      expect(isSecureHash('onlysalt:')).toBe(false);\r\n      expect(isSecureHash(':onlyhash')).toBe(false);\r\n    });\r\n  });\r\n\r\n  describe('LoginRateLimiter', () => {\r\n    beforeEach(() => {\r\n      // Clear rate limiter state\r\n      if (typeof window !== 'undefined') {\r\n        localStorage.removeItem('login_attempts');\r\n      }\r\n      loginRateLimiter.attempts.clear();\r\n    });\r\n\r\n    it('should allow login attempts initially', () => {\r\n      const result = loginRateLimiter.isRateLimited('test@example.com');\r\n      expect(result.isLimited).toBe(false);\r\n      expect(result.attemptsLeft).toBe(5);\r\n    });\r\n\r\n    it('should track failed attempts', () => {\r\n      loginRateLimiter.recordFailedAttempt('test@example.com');\r\n      const result = loginRateLimiter.isRateLimited('test@example.com');\r\n      expect(result.attemptsLeft).toBe(4);\r\n    });\r\n\r\n    it('should lockout after max attempts', () => {\r\n      for (let i = 0; i < 5; i++) {\r\n        loginRateLimiter.recordFailedAttempt('test@example.com');\r\n      }\r\n      const result = loginRateLimiter.isRateLimited('test@example.com');\r\n      expect(result.isLimited).toBe(true);\r\n      expect(result.attemptsLeft).toBe(0);\r\n    });\r\n\r\n    it('should clear attempts on successful login', () => {\r\n      loginRateLimiter.recordFailedAttempt('test@example.com');\r\n      loginRateLimiter.clearAttempts('test@example.com');\r\n      const result = loginRateLimiter.isRateLimited('test@example.com');\r\n      expect(result.isLimited).toBe(false);\r\n      expect(result.attemptsLeft).toBe(5);\r\n    });\r\n\r\n    it('should track attempts per identifier', () => {\r\n      loginRateLimiter.recordFailedAttempt('user1@example.com');\r\n      loginRateLimiter.recordFailedAttempt('user2@example.com');\r\n      \r\n      const result1 = loginRateLimiter.isRateLimited('user1@example.com');\r\n      const result2 = loginRateLimiter.isRateLimited('user2@example.com');\r\n      \r\n      expect(result1.attemptsLeft).toBe(4);\r\n      expect(result2.attemptsLeft).toBe(4);\r\n    });\r\n  });\r\n});\r\n\r\n"],"names":["global","crypto","getRandomValues","arr","i","length","subtle","importKey","format","keyData","algorithm","extractable","keyUsages","deriveBits","keyMaterial","hash","Uint8Array","buffer","describe","it","password","hashPassword","expect","toBeDefined","toBe","includes","rejects","toThrow","isValid","verifyPassword","result","validatePasswordStrength","message","toContain","longPassword","repeat","isSecureHash","beforeEach","window","localStorage","removeItem","loginRateLimiter","attempts","clear","isRateLimited","isLimited","attemptsLeft","recordFailedAttempt","clearAttempts","result1","result2"],"mappings":"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"}