{"version":3,"sources":["D:\\Tech Vitta\\Apps\\DEMO\\__tests__\\lib\\subscription.test.js"],"sourcesContent":["import {\n  getUserSubscriptionTier,\n  isPremiumUser,\n  getDailyLikesRemaining,\n  recordLike,\n  hasPremiumFeature,\n  SUBSCRIPTION_TIERS,\n  FREE_USER_LIMITS\n} from '@/lib/subscription'\n\n// Mock localStorage for subscription tests\nlet store = {};\nconst localStorageMock = {\n  getItem: jest.fn((key) => {\n    return store[key] || null;\n  }),\n  setItem: jest.fn((key, value) => {\n    store[key] = value.toString();\n  }),\n  removeItem: jest.fn((key) => {\n    delete store[key];\n  }),\n  clear: jest.fn(() => {\n    store = {};\n  })\n};\n\n// Ensure window exists\nif (typeof window === 'undefined') {\n  global.window = {};\n}\n\n// Set up localStorage before any tests\nObject.defineProperty(window, 'localStorage', {\n  value: localStorageMock,\n  writable: true,\n  configurable: true,\n});\nglobal.localStorage = localStorageMock;\n\nbeforeEach(() => {\n  // Reset the store\n  store = {};\n  \n  // Re-create mock implementations (Jest's resetMocks might clear them)\n  localStorageMock.getItem.mockImplementation((key) => {\n    return store[key] || null;\n  });\n  localStorageMock.setItem.mockImplementation((key, value) => {\n    store[key] = value.toString();\n  });\n  localStorageMock.removeItem.mockImplementation((key) => {\n    delete store[key];\n  });\n  localStorageMock.clear.mockImplementation(() => {\n    store = {};\n  });\n  \n  // Re-setup localStorage to ensure it's fresh\n  Object.defineProperty(window, 'localStorage', {\n    value: localStorageMock,\n    writable: true,\n    configurable: true,\n  });\n  global.localStorage = localStorageMock;\n});\n\ndescribe('Subscription Functions', () => {\n  const createUser = (overrides = {}) => ({\n    id: '1',\n    name: 'Test User',\n    email: 'test@example.com',\n    subscriptionTier: 'free',\n    ...overrides\n  })\n\n  describe('getUserSubscriptionTier', () => {\n    it('returns FREE for null user', () => {\n      expect(getUserSubscriptionTier(null)).toBe(SUBSCRIPTION_TIERS.FREE)\n    })\n\n    it('returns FREE for user without subscriptionTier', () => {\n      const user = createUser({ subscriptionTier: undefined })\n      expect(getUserSubscriptionTier(user)).toBe(SUBSCRIPTION_TIERS.FREE)\n    })\n\n    it('returns correct tier for premium user', () => {\n      const user = createUser({ subscriptionTier: 'plus' })\n      expect(getUserSubscriptionTier(user)).toBe('plus')\n    })\n  })\n\n  describe('isPremiumUser', () => {\n    it('returns false for free user', () => {\n      const user = createUser({ subscriptionTier: 'free' })\n      expect(isPremiumUser(user)).toBe(false)\n    })\n\n    it('returns true for basic user', () => {\n      const user = createUser({ subscriptionTier: 'basic' })\n      expect(isPremiumUser(user)).toBe(true)\n    })\n\n    it('returns true for plus user', () => {\n      const user = createUser({ subscriptionTier: 'plus' })\n      expect(isPremiumUser(user)).toBe(true)\n    })\n\n    it('returns true for vip user', () => {\n      const user = createUser({ subscriptionTier: 'vip' })\n      expect(isPremiumUser(user)).toBe(true)\n    })\n\n    it('returns false for null user', () => {\n      expect(isPremiumUser(null)).toBe(false)\n    })\n  })\n\n  describe('getDailyLikesRemaining', () => {\n    it('returns unlimited for premium users', () => {\n      const user = createUser({ subscriptionTier: 'plus' })\n      const remaining = getDailyLikesRemaining(user)\n      expect(remaining).toBe('unlimited')\n    })\n\n    it('returns limit for free users', () => {\n      const user = createUser({ subscriptionTier: 'free' })\n      const remaining = getDailyLikesRemaining(user)\n      expect(remaining).toBe(FREE_USER_LIMITS.DAILY_LIKES)\n    })\n\n    it('tracks daily likes for free users', () => {\n      const user = createUser({ subscriptionTier: 'free' })\n      \n      // Record some likes\n      recordLike(user)\n      recordLike(user)\n      \n      const remaining = getDailyLikesRemaining(user)\n      expect(remaining).toBe(FREE_USER_LIMITS.DAILY_LIKES - 2)\n    })\n\n    it('resets daily likes after 24 hours', () => {\n      const user = createUser({ \n        subscriptionTier: 'free',\n        lastLikeReset: new Date(Date.now() - 25 * 60 * 60 * 1000).toISOString()\n      })\n      \n      const remaining = getDailyLikesRemaining(user)\n      expect(remaining).toBe(FREE_USER_LIMITS.DAILY_LIKES)\n    })\n  })\n\n  describe('recordLike', () => {\n    it('returns true for premium users', () => {\n      const user = createUser({ subscriptionTier: 'plus' })\n      expect(recordLike(user)).toBe(true)\n    })\n\n    it('returns true when likes remaining', () => {\n      const user = createUser({ subscriptionTier: 'free' })\n      expect(recordLike(user)).toBe(true)\n    })\n\n    it('returns false when daily limit reached', () => {\n      const user = createUser({ subscriptionTier: 'free' })\n      \n      // Exhaust daily likes\n      for (let i = 0; i < FREE_USER_LIMITS.DAILY_LIKES; i++) {\n        recordLike(user)\n      }\n      \n      expect(recordLike(user)).toBe(false)\n    })\n  })\n\n  describe('hasPremiumFeature', () => {\n    it('returns false for free users', () => {\n      const user = createUser({ subscriptionTier: 'free' })\n      expect(hasPremiumFeature(user, 'ADVANCED_FILTERS')).toBe(false)\n    })\n\n    it('returns true for premium users', () => {\n      const user = createUser({ subscriptionTier: 'plus' })\n      expect(hasPremiumFeature(user, 'ADVANCED_FILTERS')).toBe(true)\n    })\n\n    it('returns false for invalid feature', () => {\n      const user = createUser({ subscriptionTier: 'plus' })\n      expect(hasPremiumFeature(user, 'INVALID_FEATURE')).toBe(false)\n    })\n  })\n})\n"],"names":["store","localStorageMock","getItem","jest","fn","key","setItem","value","toString","removeItem","clear","window","global","Object","defineProperty","writable","configurable","localStorage","beforeEach","mockImplementation","describe","createUser","overrides","id","name","email","subscriptionTier","it","expect","getUserSubscriptionTier","toBe","SUBSCRIPTION_TIERS","FREE","user","undefined","isPremiumUser","remaining","getDailyLikesRemaining","FREE_USER_LIMITS","DAILY_LIKES","recordLike","lastLikeReset","Date","now","toISOString","i","hasPremiumFeature"],"mappings":"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"}