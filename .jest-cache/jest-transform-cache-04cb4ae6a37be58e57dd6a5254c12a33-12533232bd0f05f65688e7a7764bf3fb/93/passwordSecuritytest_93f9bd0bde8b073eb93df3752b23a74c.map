{"version":3,"sources":["D:\\Tech Vitta\\Apps\\DEMO\\__tests__\\lib\\passwordSecurity.test.js"],"sourcesContent":["/**\r\n * Password Security Tests\r\n * Tests for password hashing, verification, and rate limiting\r\n */\r\n\r\nimport { \r\n  hashPassword, \r\n  verifyPassword, \r\n  validatePasswordStrength, \r\n  isSecureHash,\r\n  loginRateLimiter \r\n} from '@/lib/passwordSecurity';\r\n\r\n// Crypto is mocked in jest.setup.js\r\n\r\ndescribe('Password Security', () => {\r\n  describe('hashPassword', () => {\r\n    it('should hash a password successfully', async () => {\r\n      const password = 'TestPassword123';\r\n      const hash = await hashPassword(password);\r\n      \r\n      expect(hash).toBeDefined();\r\n      expect(typeof hash).toBe('string');\r\n      expect(hash.includes(':')).toBe(true);\r\n    });\r\n\r\n    it('should throw error for empty password', async () => {\r\n      await expect(hashPassword('')).rejects.toThrow();\r\n    });\r\n\r\n    it('should throw error for non-string password', async () => {\r\n      await expect(hashPassword(null)).rejects.toThrow();\r\n      await expect(hashPassword(123)).rejects.toThrow();\r\n    });\r\n  });\r\n\r\n  describe('verifyPassword', () => {\r\n    it('should verify correct password', async () => {\r\n      const password = 'TestPassword123';\r\n      const hash = await hashPassword(password);\r\n      const isValid = await verifyPassword(password, hash);\r\n      \r\n      expect(isValid).toBe(true);\r\n    });\r\n\r\n    it('should reject incorrect password', async () => {\r\n      const password = 'TestPassword123';\r\n      const hash = await hashPassword(password);\r\n      const isValid = await verifyPassword('WrongPassword', hash);\r\n      \r\n      expect(isValid).toBe(false);\r\n    });\r\n\r\n    it('should handle plain text passwords (backward compatibility)', async () => {\r\n      const password = 'plaintext123';\r\n      const isValid = await verifyPassword(password, password);\r\n      \r\n      expect(isValid).toBe(true);\r\n    });\r\n\r\n    it('should return false for empty inputs', async () => {\r\n      expect(await verifyPassword('', 'hash')).toBe(false);\r\n      expect(await verifyPassword('password', '')).toBe(false);\r\n      expect(await verifyPassword('', '')).toBe(false);\r\n    });\r\n  });\r\n\r\n  describe('validatePasswordStrength', () => {\r\n    it('should accept strong passwords', () => {\r\n      const result = validatePasswordStrength('StrongPass123');\r\n      expect(result.isValid).toBe(true);\r\n    });\r\n\r\n    it('should reject passwords shorter than 8 characters', () => {\r\n      const result = validatePasswordStrength('Short1');\r\n      expect(result.isValid).toBe(false);\r\n      expect(result.message).toContain('8 characters');\r\n    });\r\n\r\n    it('should reject passwords without numbers', () => {\r\n      const result = validatePasswordStrength('NoNumbers');\r\n      expect(result.isValid).toBe(false);\r\n      expect(result.message).toContain('number');\r\n    });\r\n\r\n    it('should reject passwords without letters', () => {\r\n      const result = validatePasswordStrength('12345678');\r\n      expect(result.isValid).toBe(false);\r\n      expect(result.message).toContain('letter');\r\n    });\r\n\r\n    it('should reject passwords longer than 128 characters', () => {\r\n      const longPassword = 'a'.repeat(129) + '1';\r\n      const result = validatePasswordStrength(longPassword);\r\n      expect(result.isValid).toBe(false);\r\n      expect(result.message).toContain('128 characters');\r\n    });\r\n\r\n    it('should reject empty passwords', () => {\r\n      const result = validatePasswordStrength('');\r\n      expect(result.isValid).toBe(false);\r\n      expect(result.message).toContain('required');\r\n    });\r\n  });\r\n\r\n  describe('isSecureHash', () => {\r\n    it('should identify secure hash format', () => {\r\n      expect(isSecureHash('salt:hash')).toBe(true);\r\n      expect(isSecureHash('abc123:def456')).toBe(true);\r\n    });\r\n\r\n    it('should reject plain text as secure hash', () => {\r\n      expect(isSecureHash('plaintext')).toBe(false);\r\n      expect(isSecureHash('password123')).toBe(false);\r\n    });\r\n\r\n    it('should handle invalid formats', () => {\r\n      expect(isSecureHash('')).toBe(false);\r\n      expect(isSecureHash(null)).toBe(false);\r\n      expect(isSecureHash('onlysalt:')).toBe(false);\r\n      expect(isSecureHash(':onlyhash')).toBe(false);\r\n    });\r\n  });\r\n\r\n  describe('LoginRateLimiter', () => {\r\n    beforeEach(() => {\r\n      // Clear rate limiter state\r\n      if (typeof window !== 'undefined') {\r\n        localStorage.removeItem('login_attempts');\r\n      }\r\n      loginRateLimiter.attempts.clear();\r\n    });\r\n\r\n    it('should allow login attempts initially', () => {\r\n      const result = loginRateLimiter.isRateLimited('test@example.com');\r\n      expect(result.isLimited).toBe(false);\r\n      expect(result.attemptsLeft).toBe(5);\r\n    });\r\n\r\n    it('should track failed attempts', () => {\r\n      loginRateLimiter.recordFailedAttempt('test@example.com');\r\n      const result = loginRateLimiter.isRateLimited('test@example.com');\r\n      expect(result.attemptsLeft).toBe(4);\r\n    });\r\n\r\n    it('should lockout after max attempts', () => {\r\n      for (let i = 0; i < 5; i++) {\r\n        loginRateLimiter.recordFailedAttempt('test@example.com');\r\n      }\r\n      const result = loginRateLimiter.isRateLimited('test@example.com');\r\n      expect(result.isLimited).toBe(true);\r\n      expect(result.attemptsLeft).toBe(0);\r\n    });\r\n\r\n    it('should clear attempts on successful login', () => {\r\n      loginRateLimiter.recordFailedAttempt('test@example.com');\r\n      loginRateLimiter.clearAttempts('test@example.com');\r\n      const result = loginRateLimiter.isRateLimited('test@example.com');\r\n      expect(result.isLimited).toBe(false);\r\n      expect(result.attemptsLeft).toBe(5);\r\n    });\r\n\r\n    it('should track attempts per identifier', () => {\r\n      loginRateLimiter.recordFailedAttempt('user1@example.com');\r\n      loginRateLimiter.recordFailedAttempt('user2@example.com');\r\n      \r\n      const result1 = loginRateLimiter.isRateLimited('user1@example.com');\r\n      const result2 = loginRateLimiter.isRateLimited('user2@example.com');\r\n      \r\n      expect(result1.attemptsLeft).toBe(4);\r\n      expect(result2.attemptsLeft).toBe(4);\r\n    });\r\n  });\r\n});\r\n\r\n"],"names":["describe","it","password","hash","hashPassword","expect","toBeDefined","toBe","includes","rejects","toThrow","isValid","verifyPassword","result","validatePasswordStrength","message","toContain","longPassword","repeat","isSecureHash","beforeEach","window","localStorage","removeItem","loginRateLimiter","attempts","clear","isRateLimited","isLimited","attemptsLeft","recordFailedAttempt","i","clearAttempts","result1","result2"],"mappings":"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"}