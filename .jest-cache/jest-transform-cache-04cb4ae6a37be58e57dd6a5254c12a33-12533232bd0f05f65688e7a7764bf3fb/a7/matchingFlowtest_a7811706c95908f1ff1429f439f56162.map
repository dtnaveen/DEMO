{"version":3,"sources":["D:\\Tech Vitta\\Apps\\DEMO\\__tests__\\integration\\matchingFlow.test.js"],"sourcesContent":["import {\r\n  getCurrentUser,\r\n  setCurrentUser,\r\n  getAllUsers,\r\n  setAllUsers,\r\n  getUserActions,\r\n  addLike,\r\n  getMatches,\r\n  setMatches\r\n} from '@/lib/localStorage'\r\nimport { calculateMatchScore } from '@/lib/matchingAlgorithm'\r\nimport { isPremiumUser, recordLike } from '@/lib/subscription'\r\n\r\n// Mock localStorage\r\nlet store = {};\r\nconst localStorageMock = {\r\n  getItem: jest.fn((key) => {\r\n    return store[key] || null;\r\n  }),\r\n  setItem: jest.fn((key, value) => {\r\n    store[key] = value.toString();\r\n  }),\r\n  removeItem: jest.fn((key) => {\r\n    delete store[key];\r\n  }),\r\n  clear: jest.fn(() => {\r\n    store = {};\r\n  })\r\n};\r\n\r\n// Ensure window exists before any tests\r\nif (typeof window === 'undefined') {\r\n  global.window = {};\r\n}\r\n\r\n// Set up localStorage before any imports or tests run\r\nObject.defineProperty(window, 'localStorage', {\r\n  value: localStorageMock,\r\n  writable: true,\r\n  configurable: true,\r\n});\r\nglobal.localStorage = localStorageMock;\r\n\r\nbeforeEach(() => {\r\n  // Reset the store\r\n  store = {};\r\n  \r\n  // Re-create mock implementations (Jest's resetMocks might clear them)\r\n  localStorageMock.getItem.mockImplementation((key) => {\r\n    return store[key] || null;\r\n  });\r\n  localStorageMock.setItem.mockImplementation((key, value) => {\r\n    store[key] = value.toString();\r\n  });\r\n  localStorageMock.removeItem.mockImplementation((key) => {\r\n    delete store[key];\r\n  });\r\n  localStorageMock.clear.mockImplementation(() => {\r\n    store = {};\r\n  });\r\n  \r\n  // Re-setup localStorage to ensure it's fresh\r\n  Object.defineProperty(window, 'localStorage', {\r\n    value: localStorageMock,\r\n    writable: true,\r\n    configurable: true,\r\n  });\r\n  global.localStorage = localStorageMock;\r\n})\r\n\r\ndescribe('Matching Flow Integration', () => {\r\n  const createUser = (id, overrides = {}) => ({\r\n    id,\r\n    name: `User ${id}`,\r\n    email: `user${id}@test.com`,\r\n    age: 25,\r\n    gender: 'Male',\r\n    ageGroup: 'young',\r\n    valueAnswers: [1, 2, 3, 4, 5, 1, 2, 3, 4, 5],\r\n    contentAnswers: [1, 2, 3, 4, 5],\r\n    subscriptionTier: 'free',\r\n    ...overrides\r\n  })\r\n\r\n  it('completes full matching flow', () => {\r\n    // Setup: Create users\r\n    const currentUser = createUser('current')\r\n    const otherUser = createUser('other')\r\n    \r\n    setCurrentUser(currentUser)\r\n    setAllUsers([currentUser, otherUser])\r\n\r\n    // Step 1: Calculate match score\r\n    const matchScore = calculateMatchScore(currentUser, otherUser)\r\n    expect(matchScore.percentage).toBeGreaterThan(0)\r\n\r\n    // Step 2: Check if user can like (free user)\r\n    const canLike = recordLike(currentUser)\r\n    expect(canLike).toBe(true)\r\n\r\n    // Step 3: Add like\r\n    addLike(otherUser.id)\r\n    const actions = getUserActions()\r\n    expect(actions.likes).toContain(otherUser.id)\r\n\r\n    // Step 4: Check if mutual like (simulate)\r\n    const matches = getMatches()\r\n    // In real app, would check if otherUser also liked currentUser\r\n    expect(Array.isArray(matches)).toBe(true)\r\n  })\r\n\r\n  it('handles premium user unlimited likes', () => {\r\n    const premiumUser = createUser('premium', { subscriptionTier: 'plus' })\r\n    setCurrentUser(premiumUser)\r\n\r\n    // Premium users can like unlimited times (test with 10 instead of 100 for speed)\r\n    for (let i = 0; i < 10; i++) {\r\n      expect(recordLike(premiumUser)).toBe(true)\r\n    }\r\n    // Verify it still works after multiple likes\r\n    expect(recordLike(premiumUser)).toBe(true)\r\n  })\r\n\r\n  it('enforces daily like limit for free users', () => {\r\n    const freeUser = createUser('free', { subscriptionTier: 'free' })\r\n    setCurrentUser(freeUser)\r\n\r\n    // Free users have 10 daily likes\r\n    let likeCount = 0\r\n    let canLike = true\r\n    while (canLike && likeCount < 15) {\r\n      canLike = recordLike(freeUser)\r\n      if (canLike) {\r\n        likeCount++\r\n      }\r\n    }\r\n\r\n    expect(likeCount).toBeLessThanOrEqual(10)\r\n    // After 10 likes, should not be able to like more\r\n    expect(recordLike(freeUser)).toBe(false)\r\n  })\r\n\r\n  it('filters out passed users from discovery', () => {\r\n    const currentUser = createUser('current')\r\n    const user1 = createUser('1')\r\n    const user2 = createUser('2')\r\n    \r\n    setCurrentUser(currentUser)\r\n    setAllUsers([currentUser, user1, user2])\r\n\r\n    // Pass on user1\r\n    const { addPass } = require('@/lib/localStorage')\r\n    addPass(user1.id)\r\n\r\n    // Filter users (simulate discover page logic)\r\n    const allUsers = getAllUsers()\r\n    const actions = getUserActions()\r\n    const availableUsers = allUsers.filter(\r\n      user => user.id !== currentUser.id && !actions.passes.includes(user.id)\r\n    )\r\n\r\n    expect(availableUsers).not.toContainEqual(expect.objectContaining({ id: '1' }))\r\n    expect(availableUsers).toContainEqual(expect.objectContaining({ id: '2' }))\r\n  })\r\n})\r\n\r\n"],"names":["store","localStorageMock","getItem","jest","fn","key","setItem","value","toString","removeItem","clear","window","global","Object","defineProperty","writable","configurable","localStorage","beforeEach","mockImplementation","describe","createUser","id","overrides","name","email","age","gender","ageGroup","valueAnswers","contentAnswers","subscriptionTier","it","currentUser","otherUser","setCurrentUser","setAllUsers","matchScore","calculateMatchScore","expect","percentage","toBeGreaterThan","canLike","recordLike","toBe","addLike","actions","getUserActions","likes","toContain","matches","getMatches","Array","isArray","premiumUser","i","freeUser","likeCount","toBeLessThanOrEqual","user1","user2","addPass","require","allUsers","getAllUsers","availableUsers","filter","user","passes","includes","not","toContainEqual","objectContaining"],"mappings":"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"}