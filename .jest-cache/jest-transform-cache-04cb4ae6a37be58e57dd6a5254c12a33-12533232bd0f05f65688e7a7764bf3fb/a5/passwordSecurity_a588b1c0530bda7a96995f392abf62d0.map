{"version":3,"sources":["D:\\Tech Vitta\\Apps\\DEMO\\lib\\passwordSecurity.js"],"sourcesContent":["/**\r\n * Password Security Utilities\r\n * Implements secure password hashing and verification using Web Crypto API\r\n * Production-ready security implementation\r\n */\r\n\r\n/**\r\n * Hash a password using Web Crypto API (PBKDF2)\r\n * @param {string} password - Plain text password\r\n * @returns {Promise<string>} Hashed password with salt\r\n */\r\nexport async function hashPassword(password) {\r\n  if (!password || typeof password !== 'string') {\r\n    throw new Error('Password must be a non-empty string');\r\n  }\r\n\r\n  // Generate a random salt\r\n  const salt = crypto.getRandomValues(new Uint8Array(16));\r\n  const saltHex = Array.from(salt).map(b => b.toString(16).padStart(2, '0')).join('');\r\n\r\n  // Import password as key material\r\n  const encoder = new TextEncoder();\r\n  const passwordData = encoder.encode(password);\r\n\r\n  // Use PBKDF2 for key derivation (100,000 iterations for security)\r\n  const keyMaterial = await crypto.subtle.importKey(\r\n    'raw',\r\n    passwordData,\r\n    { name: 'PBKDF2' },\r\n    false,\r\n    ['deriveBits']\r\n  );\r\n\r\n  const derivedBits = await crypto.subtle.deriveBits(\r\n    {\r\n      name: 'PBKDF2',\r\n      salt: salt,\r\n      iterations: 100000,\r\n      hash: 'SHA-256'\r\n    },\r\n    keyMaterial,\r\n    256 // 32 bytes = 256 bits\r\n  );\r\n\r\n  // Convert to hex string\r\n  const hashArray = Array.from(new Uint8Array(derivedBits));\r\n  const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');\r\n\r\n  // Return format: salt:hash (both hex)\r\n  return `${saltHex}:${hashHex}`;\r\n}\r\n\r\n/**\r\n * Verify a password against a hash\r\n * @param {string} password - Plain text password to verify\r\n * @param {string} hash - Stored hash (format: salt:hash or plain text for backward compatibility)\r\n * @returns {Promise<boolean>} True if password matches\r\n */\r\nexport async function verifyPassword(password, hash) {\r\n  if (!password || !hash) {\r\n    return false;\r\n  }\r\n\r\n  // Backward compatibility: if hash doesn't contain ':', it's plain text (old format)\r\n  // This allows existing test users to still log in, then their password will be migrated\r\n  if (!hash.includes(':')) {\r\n    // Plain text comparison for backward compatibility\r\n    return password === hash;\r\n  }\r\n\r\n  try {\r\n    // Extract salt and hash from stored format\r\n    const [saltHex, storedHash] = hash.split(':');\r\n    if (!saltHex || !storedHash) {\r\n      return false;\r\n    }\r\n\r\n    // Convert salt from hex to Uint8Array\r\n    const salt = new Uint8Array(\r\n      saltHex.match(/.{1,2}/g).map(byte => parseInt(byte, 16))\r\n    );\r\n\r\n    // Import password as key material\r\n    const encoder = new TextEncoder();\r\n    const passwordData = encoder.encode(password);\r\n\r\n    const keyMaterial = await crypto.subtle.importKey(\r\n      'raw',\r\n      passwordData,\r\n      { name: 'PBKDF2' },\r\n      false,\r\n      ['deriveBits']\r\n    );\r\n\r\n    // Derive hash with same parameters\r\n    const derivedBits = await crypto.subtle.deriveBits(\r\n      {\r\n        name: 'PBKDF2',\r\n        salt: salt,\r\n        iterations: 100000,\r\n        hash: 'SHA-256'\r\n      },\r\n      keyMaterial,\r\n      256\r\n    );\r\n\r\n    // Convert to hex\r\n    const hashArray = Array.from(new Uint8Array(derivedBits));\r\n    const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');\r\n\r\n    // Compare hashes (constant-time comparison)\r\n    return hashHex === storedHash;\r\n  } catch (error) {\r\n    console.error('Error verifying password:', error);\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Check if a password hash is in the new secure format\r\n * @param {string} hash - Password hash to check\r\n * @returns {boolean} True if hash is in secure format\r\n */\r\nexport function isSecureHash(hash) {\r\n  if (!hash || typeof hash !== 'string') {\r\n    return false;\r\n  }\r\n  const parts = hash.split(':');\r\n  return parts.length === 2 && parts[0].length > 0 && parts[1].length > 0;\r\n}\r\n\r\n/**\r\n * Validate password strength\r\n * @param {string} password - Password to validate\r\n * @returns {Object} Validation result with isValid and message\r\n */\r\nexport function validatePasswordStrength(password) {\r\n  if (!password) {\r\n    return { isValid: false, message: 'Password is required' };\r\n  }\r\n\r\n  if (password.length < 8) {\r\n    return { isValid: false, message: 'Password must be at least 8 characters' };\r\n  }\r\n\r\n  if (password.length > 128) {\r\n    return { isValid: false, message: 'Password must be less than 128 characters' };\r\n  }\r\n\r\n  // Check for at least one number\r\n  if (!/\\d/.test(password)) {\r\n    return { isValid: false, message: 'Password must contain at least one number' };\r\n  }\r\n\r\n  // Check for at least one letter\r\n  if (!/[a-zA-Z]/.test(password)) {\r\n    return { isValid: false, message: 'Password must contain at least one letter' };\r\n  }\r\n\r\n  return { isValid: true, message: 'Password is strong' };\r\n}\r\n\r\n/**\r\n * Rate limiting for login attempts\r\n */\r\nclass LoginRateLimiter {\r\n  constructor() {\r\n    this.attempts = new Map(); // identifier -> { count, resetTime }\r\n    this.maxAttempts = 5; // Maximum attempts\r\n    this.lockoutDuration = 15 * 60 * 1000; // 15 minutes in milliseconds\r\n  }\r\n\r\n  /**\r\n   * Record a failed login attempt\r\n   * @param {string} identifier - Email or username\r\n   */\r\n  recordFailedAttempt(identifier) {\r\n    if (typeof window === 'undefined') return;\r\n\r\n    const key = identifier.toLowerCase();\r\n    const now = Date.now();\r\n    const record = this.attempts.get(key) || { count: 0, resetTime: now + this.lockoutDuration };\r\n\r\n    // Reset if lockout period has passed\r\n    if (now > record.resetTime) {\r\n      record.count = 0;\r\n      record.resetTime = now + this.lockoutDuration;\r\n    }\r\n\r\n    record.count++;\r\n    this.attempts.set(key, record);\r\n\r\n    // Persist to localStorage\r\n    try {\r\n      const attemptsData = {};\r\n      this.attempts.forEach((value, key) => {\r\n        attemptsData[key] = value;\r\n      });\r\n      localStorage.setItem('login_attempts', JSON.stringify(attemptsData));\r\n    } catch (error) {\r\n      console.error('Error saving login attempts:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear failed attempts for an identifier (on successful login)\r\n   * @param {string} identifier - Email or username\r\n   */\r\n  clearAttempts(identifier) {\r\n    if (typeof window === 'undefined') return;\r\n\r\n    const key = identifier.toLowerCase();\r\n    this.attempts.delete(key);\r\n\r\n    // Update localStorage\r\n    try {\r\n      const attemptsData = JSON.parse(localStorage.getItem('login_attempts') || '{}');\r\n      delete attemptsData[key];\r\n      localStorage.setItem('login_attempts', JSON.stringify(attemptsData));\r\n    } catch (error) {\r\n      console.error('Error clearing login attempts:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check if identifier is rate limited\r\n   * @param {string} identifier - Email or username\r\n   * @returns {Object} { isLimited: boolean, remainingTime: number (ms), attemptsLeft: number }\r\n   */\r\n  isRateLimited(identifier) {\r\n    if (typeof window === 'undefined') {\r\n      return { isLimited: false, remainingTime: 0, attemptsLeft: this.maxAttempts };\r\n    }\r\n\r\n    // Load from localStorage\r\n    try {\r\n      const attemptsData = JSON.parse(localStorage.getItem('login_attempts') || '{}');\r\n      this.attempts.clear();\r\n      Object.entries(attemptsData).forEach(([key, value]) => {\r\n        this.attempts.set(key, value);\r\n      });\r\n    } catch (error) {\r\n      // Ignore errors\r\n    }\r\n\r\n    const key = identifier.toLowerCase();\r\n    const record = this.attempts.get(key);\r\n\r\n    if (!record) {\r\n      return { isLimited: false, remainingTime: 0, attemptsLeft: this.maxAttempts };\r\n    }\r\n\r\n    const now = Date.now();\r\n\r\n    // Reset if lockout period has passed\r\n    if (now > record.resetTime) {\r\n      this.attempts.delete(key);\r\n      return { isLimited: false, remainingTime: 0, attemptsLeft: this.maxAttempts };\r\n    }\r\n\r\n    const attemptsLeft = Math.max(0, this.maxAttempts - record.count);\r\n    const isLimited = record.count >= this.maxAttempts;\r\n    const remainingTime = Math.max(0, record.resetTime - now);\r\n\r\n    return { isLimited, remainingTime, attemptsLeft };\r\n  }\r\n}\r\n\r\n// Export singleton instance\r\nexport const loginRateLimiter = new LoginRateLimiter();\r\n\r\n"],"names":["hashPassword","isSecureHash","loginRateLimiter","validatePasswordStrength","verifyPassword","password","Error","salt","crypto","getRandomValues","Uint8Array","saltHex","Array","from","map","b","toString","padStart","join","encoder","TextEncoder","passwordData","encode","keyMaterial","subtle","importKey","name","derivedBits","deriveBits","iterations","hash","hashArray","hashHex","includes","storedHash","split","match","byte","parseInt","error","console","parts","length","isValid","message","test","LoginRateLimiter","attempts","Map","maxAttempts","lockoutDuration","recordFailedAttempt","identifier","window","key","toLowerCase","now","Date","record","get","count","resetTime","set","attemptsData","forEach","value","localStorage","setItem","JSON","stringify","clearAttempts","delete","parse","getItem","isRateLimited","isLimited","remainingTime","attemptsLeft","clear","Object","entries","Math","max"],"mappings":"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"}