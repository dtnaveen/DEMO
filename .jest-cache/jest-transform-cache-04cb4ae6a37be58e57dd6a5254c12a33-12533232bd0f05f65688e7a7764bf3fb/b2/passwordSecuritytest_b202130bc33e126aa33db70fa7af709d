7d15f5e45a9c6694ee641db1904ee9a7
/**
 * Password Security Tests
 * Tests for password hashing, verification, and rate limiting
 */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
const _passwordSecurity = require("../../lib/passwordSecurity.js");
// Mock crypto for testing
beforeAll(()=>{
    if (typeof global.crypto === 'undefined') {
        global.crypto = {
            getRandomValues: (arr)=>{
                // Return predictable values for testing
                for(let i = 0; i < arr.length; i++){
                    arr[i] = i % 256;
                }
                return arr;
            },
            subtle: {
                importKey: jest.fn().mockResolvedValue({
                    format: 'raw',
                    keyData: new Uint8Array(),
                    algorithm: {
                        name: 'PBKDF2'
                    },
                    extractable: false,
                    keyUsages: [
                        'deriveBits'
                    ]
                }),
                deriveBits: jest.fn().mockImplementation(async (algorithm, keyMaterial, length)=>{
                    // Return predictable hash for testing
                    const hash = new Uint8Array(length / 8);
                    for(let i = 0; i < hash.length; i++){
                        hash[i] = i * 7 % 256;
                    }
                    return hash.buffer;
                })
            }
        };
    }
});
describe('Password Security', ()=>{
    describe('hashPassword', ()=>{
        it('should hash a password successfully', async ()=>{
            const password = 'TestPassword123';
            const hash = await (0, _passwordSecurity.hashPassword)(password);
            expect(hash).toBeDefined();
            expect(typeof hash).toBe('string');
            expect(hash.includes(':')).toBe(true);
        });
        it('should throw error for empty password', async ()=>{
            await expect((0, _passwordSecurity.hashPassword)('')).rejects.toThrow();
        });
        it('should throw error for non-string password', async ()=>{
            await expect((0, _passwordSecurity.hashPassword)(null)).rejects.toThrow();
            await expect((0, _passwordSecurity.hashPassword)(123)).rejects.toThrow();
        });
    });
    describe('verifyPassword', ()=>{
        it('should verify correct password', async ()=>{
            const password = 'TestPassword123';
            const hash = await (0, _passwordSecurity.hashPassword)(password);
            const isValid = await (0, _passwordSecurity.verifyPassword)(password, hash);
            expect(isValid).toBe(true);
        });
        it('should reject incorrect password', async ()=>{
            const password = 'TestPassword123';
            const hash = await (0, _passwordSecurity.hashPassword)(password);
            const isValid = await (0, _passwordSecurity.verifyPassword)('WrongPassword', hash);
            expect(isValid).toBe(false);
        });
        it('should handle plain text passwords (backward compatibility)', async ()=>{
            const password = 'plaintext123';
            const isValid = await (0, _passwordSecurity.verifyPassword)(password, password);
            expect(isValid).toBe(true);
        });
        it('should return false for empty inputs', async ()=>{
            expect(await (0, _passwordSecurity.verifyPassword)('', 'hash')).toBe(false);
            expect(await (0, _passwordSecurity.verifyPassword)('password', '')).toBe(false);
            expect(await (0, _passwordSecurity.verifyPassword)('', '')).toBe(false);
        });
    });
    describe('validatePasswordStrength', ()=>{
        it('should accept strong passwords', ()=>{
            const result = (0, _passwordSecurity.validatePasswordStrength)('StrongPass123');
            expect(result.isValid).toBe(true);
        });
        it('should reject passwords shorter than 8 characters', ()=>{
            const result = (0, _passwordSecurity.validatePasswordStrength)('Short1');
            expect(result.isValid).toBe(false);
            expect(result.message).toContain('8 characters');
        });
        it('should reject passwords without numbers', ()=>{
            const result = (0, _passwordSecurity.validatePasswordStrength)('NoNumbers');
            expect(result.isValid).toBe(false);
            expect(result.message).toContain('number');
        });
        it('should reject passwords without letters', ()=>{
            const result = (0, _passwordSecurity.validatePasswordStrength)('12345678');
            expect(result.isValid).toBe(false);
            expect(result.message).toContain('letter');
        });
        it('should reject passwords longer than 128 characters', ()=>{
            const longPassword = 'a'.repeat(129) + '1';
            const result = (0, _passwordSecurity.validatePasswordStrength)(longPassword);
            expect(result.isValid).toBe(false);
            expect(result.message).toContain('128 characters');
        });
        it('should reject empty passwords', ()=>{
            const result = (0, _passwordSecurity.validatePasswordStrength)('');
            expect(result.isValid).toBe(false);
            expect(result.message).toContain('required');
        });
    });
    describe('isSecureHash', ()=>{
        it('should identify secure hash format', ()=>{
            expect((0, _passwordSecurity.isSecureHash)('salt:hash')).toBe(true);
            expect((0, _passwordSecurity.isSecureHash)('abc123:def456')).toBe(true);
        });
        it('should reject plain text as secure hash', ()=>{
            expect((0, _passwordSecurity.isSecureHash)('plaintext')).toBe(false);
            expect((0, _passwordSecurity.isSecureHash)('password123')).toBe(false);
        });
        it('should handle invalid formats', ()=>{
            expect((0, _passwordSecurity.isSecureHash)('')).toBe(false);
            expect((0, _passwordSecurity.isSecureHash)(null)).toBe(false);
            expect((0, _passwordSecurity.isSecureHash)('onlysalt:')).toBe(false);
            expect((0, _passwordSecurity.isSecureHash)(':onlyhash')).toBe(false);
        });
    });
    describe('LoginRateLimiter', ()=>{
        beforeEach(()=>{
            // Clear rate limiter state
            if (typeof window !== 'undefined') {
                localStorage.removeItem('login_attempts');
            }
            _passwordSecurity.loginRateLimiter.attempts.clear();
        });
        it('should allow login attempts initially', ()=>{
            const result = _passwordSecurity.loginRateLimiter.isRateLimited('test@example.com');
            expect(result.isLimited).toBe(false);
            expect(result.attemptsLeft).toBe(5);
        });
        it('should track failed attempts', ()=>{
            _passwordSecurity.loginRateLimiter.recordFailedAttempt('test@example.com');
            const result = _passwordSecurity.loginRateLimiter.isRateLimited('test@example.com');
            expect(result.attemptsLeft).toBe(4);
        });
        it('should lockout after max attempts', ()=>{
            for(let i = 0; i < 5; i++){
                _passwordSecurity.loginRateLimiter.recordFailedAttempt('test@example.com');
            }
            const result = _passwordSecurity.loginRateLimiter.isRateLimited('test@example.com');
            expect(result.isLimited).toBe(true);
            expect(result.attemptsLeft).toBe(0);
        });
        it('should clear attempts on successful login', ()=>{
            _passwordSecurity.loginRateLimiter.recordFailedAttempt('test@example.com');
            _passwordSecurity.loginRateLimiter.clearAttempts('test@example.com');
            const result = _passwordSecurity.loginRateLimiter.isRateLimited('test@example.com');
            expect(result.isLimited).toBe(false);
            expect(result.attemptsLeft).toBe(5);
        });
        it('should track attempts per identifier', ()=>{
            _passwordSecurity.loginRateLimiter.recordFailedAttempt('user1@example.com');
            _passwordSecurity.loginRateLimiter.recordFailedAttempt('user2@example.com');
            const result1 = _passwordSecurity.loginRateLimiter.isRateLimited('user1@example.com');
            const result2 = _passwordSecurity.loginRateLimiter.isRateLimited('user2@example.com');
            expect(result1.attemptsLeft).toBe(4);
            expect(result2.attemptsLeft).toBe(4);
        });
    });
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkQ6XFxUZWNoIFZpdHRhXFxBcHBzXFxERU1PXFxfX3Rlc3RzX19cXGxpYlxccGFzc3dvcmRTZWN1cml0eS50ZXN0LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBQYXNzd29yZCBTZWN1cml0eSBUZXN0c1xyXG4gKiBUZXN0cyBmb3IgcGFzc3dvcmQgaGFzaGluZywgdmVyaWZpY2F0aW9uLCBhbmQgcmF0ZSBsaW1pdGluZ1xyXG4gKi9cclxuXHJcbmltcG9ydCB7IFxyXG4gIGhhc2hQYXNzd29yZCwgXHJcbiAgdmVyaWZ5UGFzc3dvcmQsIFxyXG4gIHZhbGlkYXRlUGFzc3dvcmRTdHJlbmd0aCwgXHJcbiAgaXNTZWN1cmVIYXNoLFxyXG4gIGxvZ2luUmF0ZUxpbWl0ZXIgXHJcbn0gZnJvbSAnQC9saWIvcGFzc3dvcmRTZWN1cml0eSc7XHJcblxyXG4vLyBNb2NrIGNyeXB0byBmb3IgdGVzdGluZ1xyXG5iZWZvcmVBbGwoKCkgPT4ge1xyXG4gIGlmICh0eXBlb2YgZ2xvYmFsLmNyeXB0byA9PT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgIGdsb2JhbC5jcnlwdG8gPSB7XHJcbiAgICAgIGdldFJhbmRvbVZhbHVlczogKGFycikgPT4ge1xyXG4gICAgICAgIC8vIFJldHVybiBwcmVkaWN0YWJsZSB2YWx1ZXMgZm9yIHRlc3RpbmdcclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFyci5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgYXJyW2ldID0gaSAlIDI1NjtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGFycjtcclxuICAgICAgfSxcclxuICAgICAgc3VidGxlOiB7XHJcbiAgICAgICAgaW1wb3J0S2V5OiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoeyBmb3JtYXQ6ICdyYXcnLCBrZXlEYXRhOiBuZXcgVWludDhBcnJheSgpLCBhbGdvcml0aG06IHsgbmFtZTogJ1BCS0RGMicgfSwgZXh0cmFjdGFibGU6IGZhbHNlLCBrZXlVc2FnZXM6IFsnZGVyaXZlQml0cyddIH0pLFxyXG4gICAgICAgIGRlcml2ZUJpdHM6IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oYXN5bmMgKGFsZ29yaXRobSwga2V5TWF0ZXJpYWwsIGxlbmd0aCkgPT4ge1xyXG4gICAgICAgICAgLy8gUmV0dXJuIHByZWRpY3RhYmxlIGhhc2ggZm9yIHRlc3RpbmdcclxuICAgICAgICAgIGNvbnN0IGhhc2ggPSBuZXcgVWludDhBcnJheShsZW5ndGggLyA4KTtcclxuICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaGFzaC5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBoYXNoW2ldID0gKGkgKiA3KSAlIDI1NjtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIHJldHVybiBoYXNoLmJ1ZmZlcjtcclxuICAgICAgICB9KVxyXG4gICAgICB9XHJcbiAgICB9O1xyXG4gIH1cclxufSk7XHJcblxyXG5kZXNjcmliZSgnUGFzc3dvcmQgU2VjdXJpdHknLCAoKSA9PiB7XHJcbiAgZGVzY3JpYmUoJ2hhc2hQYXNzd29yZCcsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgaGFzaCBhIHBhc3N3b3JkIHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgcGFzc3dvcmQgPSAnVGVzdFBhc3N3b3JkMTIzJztcclxuICAgICAgY29uc3QgaGFzaCA9IGF3YWl0IGhhc2hQYXNzd29yZChwYXNzd29yZCk7XHJcbiAgICAgIFxyXG4gICAgICBleHBlY3QoaGFzaCkudG9CZURlZmluZWQoKTtcclxuICAgICAgZXhwZWN0KHR5cGVvZiBoYXNoKS50b0JlKCdzdHJpbmcnKTtcclxuICAgICAgZXhwZWN0KGhhc2guaW5jbHVkZXMoJzonKSkudG9CZSh0cnVlKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgdGhyb3cgZXJyb3IgZm9yIGVtcHR5IHBhc3N3b3JkJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBhd2FpdCBleHBlY3QoaGFzaFBhc3N3b3JkKCcnKSkucmVqZWN0cy50b1Rocm93KCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHRocm93IGVycm9yIGZvciBub24tc3RyaW5nIHBhc3N3b3JkJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBhd2FpdCBleHBlY3QoaGFzaFBhc3N3b3JkKG51bGwpKS5yZWplY3RzLnRvVGhyb3coKTtcclxuICAgICAgYXdhaXQgZXhwZWN0KGhhc2hQYXNzd29yZCgxMjMpKS5yZWplY3RzLnRvVGhyb3coKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgndmVyaWZ5UGFzc3dvcmQnLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIHZlcmlmeSBjb3JyZWN0IHBhc3N3b3JkJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBwYXNzd29yZCA9ICdUZXN0UGFzc3dvcmQxMjMnO1xyXG4gICAgICBjb25zdCBoYXNoID0gYXdhaXQgaGFzaFBhc3N3b3JkKHBhc3N3b3JkKTtcclxuICAgICAgY29uc3QgaXNWYWxpZCA9IGF3YWl0IHZlcmlmeVBhc3N3b3JkKHBhc3N3b3JkLCBoYXNoKTtcclxuICAgICAgXHJcbiAgICAgIGV4cGVjdChpc1ZhbGlkKS50b0JlKHRydWUpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCByZWplY3QgaW5jb3JyZWN0IHBhc3N3b3JkJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBwYXNzd29yZCA9ICdUZXN0UGFzc3dvcmQxMjMnO1xyXG4gICAgICBjb25zdCBoYXNoID0gYXdhaXQgaGFzaFBhc3N3b3JkKHBhc3N3b3JkKTtcclxuICAgICAgY29uc3QgaXNWYWxpZCA9IGF3YWl0IHZlcmlmeVBhc3N3b3JkKCdXcm9uZ1Bhc3N3b3JkJywgaGFzaCk7XHJcbiAgICAgIFxyXG4gICAgICBleHBlY3QoaXNWYWxpZCkudG9CZShmYWxzZSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBwbGFpbiB0ZXh0IHBhc3N3b3JkcyAoYmFja3dhcmQgY29tcGF0aWJpbGl0eSknLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHBhc3N3b3JkID0gJ3BsYWludGV4dDEyMyc7XHJcbiAgICAgIGNvbnN0IGlzVmFsaWQgPSBhd2FpdCB2ZXJpZnlQYXNzd29yZChwYXNzd29yZCwgcGFzc3dvcmQpO1xyXG4gICAgICBcclxuICAgICAgZXhwZWN0KGlzVmFsaWQpLnRvQmUodHJ1ZSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHJldHVybiBmYWxzZSBmb3IgZW1wdHkgaW5wdXRzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBleHBlY3QoYXdhaXQgdmVyaWZ5UGFzc3dvcmQoJycsICdoYXNoJykpLnRvQmUoZmFsc2UpO1xyXG4gICAgICBleHBlY3QoYXdhaXQgdmVyaWZ5UGFzc3dvcmQoJ3Bhc3N3b3JkJywgJycpKS50b0JlKGZhbHNlKTtcclxuICAgICAgZXhwZWN0KGF3YWl0IHZlcmlmeVBhc3N3b3JkKCcnLCAnJykpLnRvQmUoZmFsc2UpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCd2YWxpZGF0ZVBhc3N3b3JkU3RyZW5ndGgnLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIGFjY2VwdCBzdHJvbmcgcGFzc3dvcmRzJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCByZXN1bHQgPSB2YWxpZGF0ZVBhc3N3b3JkU3RyZW5ndGgoJ1N0cm9uZ1Bhc3MxMjMnKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5pc1ZhbGlkKS50b0JlKHRydWUpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCByZWplY3QgcGFzc3dvcmRzIHNob3J0ZXIgdGhhbiA4IGNoYXJhY3RlcnMnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IHZhbGlkYXRlUGFzc3dvcmRTdHJlbmd0aCgnU2hvcnQxJyk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuaXNWYWxpZCkudG9CZShmYWxzZSk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQubWVzc2FnZSkudG9Db250YWluKCc4IGNoYXJhY3RlcnMnKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgcmVqZWN0IHBhc3N3b3JkcyB3aXRob3V0IG51bWJlcnMnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IHZhbGlkYXRlUGFzc3dvcmRTdHJlbmd0aCgnTm9OdW1iZXJzJyk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuaXNWYWxpZCkudG9CZShmYWxzZSk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQubWVzc2FnZSkudG9Db250YWluKCdudW1iZXInKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgcmVqZWN0IHBhc3N3b3JkcyB3aXRob3V0IGxldHRlcnMnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IHZhbGlkYXRlUGFzc3dvcmRTdHJlbmd0aCgnMTIzNDU2NzgnKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5pc1ZhbGlkKS50b0JlKGZhbHNlKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5tZXNzYWdlKS50b0NvbnRhaW4oJ2xldHRlcicpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCByZWplY3QgcGFzc3dvcmRzIGxvbmdlciB0aGFuIDEyOCBjaGFyYWN0ZXJzJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBsb25nUGFzc3dvcmQgPSAnYScucmVwZWF0KDEyOSkgKyAnMSc7XHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IHZhbGlkYXRlUGFzc3dvcmRTdHJlbmd0aChsb25nUGFzc3dvcmQpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LmlzVmFsaWQpLnRvQmUoZmFsc2UpO1xyXG4gICAgICBleHBlY3QocmVzdWx0Lm1lc3NhZ2UpLnRvQ29udGFpbignMTI4IGNoYXJhY3RlcnMnKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgcmVqZWN0IGVtcHR5IHBhc3N3b3JkcycsICgpID0+IHtcclxuICAgICAgY29uc3QgcmVzdWx0ID0gdmFsaWRhdGVQYXNzd29yZFN0cmVuZ3RoKCcnKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5pc1ZhbGlkKS50b0JlKGZhbHNlKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5tZXNzYWdlKS50b0NvbnRhaW4oJ3JlcXVpcmVkJyk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2lzU2VjdXJlSGFzaCcsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgaWRlbnRpZnkgc2VjdXJlIGhhc2ggZm9ybWF0JywgKCkgPT4ge1xyXG4gICAgICBleHBlY3QoaXNTZWN1cmVIYXNoKCdzYWx0Omhhc2gnKSkudG9CZSh0cnVlKTtcclxuICAgICAgZXhwZWN0KGlzU2VjdXJlSGFzaCgnYWJjMTIzOmRlZjQ1NicpKS50b0JlKHRydWUpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCByZWplY3QgcGxhaW4gdGV4dCBhcyBzZWN1cmUgaGFzaCcsICgpID0+IHtcclxuICAgICAgZXhwZWN0KGlzU2VjdXJlSGFzaCgncGxhaW50ZXh0JykpLnRvQmUoZmFsc2UpO1xyXG4gICAgICBleHBlY3QoaXNTZWN1cmVIYXNoKCdwYXNzd29yZDEyMycpKS50b0JlKGZhbHNlKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGludmFsaWQgZm9ybWF0cycsICgpID0+IHtcclxuICAgICAgZXhwZWN0KGlzU2VjdXJlSGFzaCgnJykpLnRvQmUoZmFsc2UpO1xyXG4gICAgICBleHBlY3QoaXNTZWN1cmVIYXNoKG51bGwpKS50b0JlKGZhbHNlKTtcclxuICAgICAgZXhwZWN0KGlzU2VjdXJlSGFzaCgnb25seXNhbHQ6JykpLnRvQmUoZmFsc2UpO1xyXG4gICAgICBleHBlY3QoaXNTZWN1cmVIYXNoKCc6b25seWhhc2gnKSkudG9CZShmYWxzZSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ0xvZ2luUmF0ZUxpbWl0ZXInLCAoKSA9PiB7XHJcbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcclxuICAgICAgLy8gQ2xlYXIgcmF0ZSBsaW1pdGVyIHN0YXRlXHJcbiAgICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJykge1xyXG4gICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCdsb2dpbl9hdHRlbXB0cycpO1xyXG4gICAgICB9XHJcbiAgICAgIGxvZ2luUmF0ZUxpbWl0ZXIuYXR0ZW1wdHMuY2xlYXIoKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgYWxsb3cgbG9naW4gYXR0ZW1wdHMgaW5pdGlhbGx5JywgKCkgPT4ge1xyXG4gICAgICBjb25zdCByZXN1bHQgPSBsb2dpblJhdGVMaW1pdGVyLmlzUmF0ZUxpbWl0ZWQoJ3Rlc3RAZXhhbXBsZS5jb20nKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5pc0xpbWl0ZWQpLnRvQmUoZmFsc2UpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LmF0dGVtcHRzTGVmdCkudG9CZSg1KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgdHJhY2sgZmFpbGVkIGF0dGVtcHRzJywgKCkgPT4ge1xyXG4gICAgICBsb2dpblJhdGVMaW1pdGVyLnJlY29yZEZhaWxlZEF0dGVtcHQoJ3Rlc3RAZXhhbXBsZS5jb20nKTtcclxuICAgICAgY29uc3QgcmVzdWx0ID0gbG9naW5SYXRlTGltaXRlci5pc1JhdGVMaW1pdGVkKCd0ZXN0QGV4YW1wbGUuY29tJyk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuYXR0ZW1wdHNMZWZ0KS50b0JlKDQpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBsb2Nrb3V0IGFmdGVyIG1heCBhdHRlbXB0cycsICgpID0+IHtcclxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA1OyBpKyspIHtcclxuICAgICAgICBsb2dpblJhdGVMaW1pdGVyLnJlY29yZEZhaWxlZEF0dGVtcHQoJ3Rlc3RAZXhhbXBsZS5jb20nKTtcclxuICAgICAgfVxyXG4gICAgICBjb25zdCByZXN1bHQgPSBsb2dpblJhdGVMaW1pdGVyLmlzUmF0ZUxpbWl0ZWQoJ3Rlc3RAZXhhbXBsZS5jb20nKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5pc0xpbWl0ZWQpLnRvQmUodHJ1ZSk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuYXR0ZW1wdHNMZWZ0KS50b0JlKDApO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBjbGVhciBhdHRlbXB0cyBvbiBzdWNjZXNzZnVsIGxvZ2luJywgKCkgPT4ge1xyXG4gICAgICBsb2dpblJhdGVMaW1pdGVyLnJlY29yZEZhaWxlZEF0dGVtcHQoJ3Rlc3RAZXhhbXBsZS5jb20nKTtcclxuICAgICAgbG9naW5SYXRlTGltaXRlci5jbGVhckF0dGVtcHRzKCd0ZXN0QGV4YW1wbGUuY29tJyk7XHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGxvZ2luUmF0ZUxpbWl0ZXIuaXNSYXRlTGltaXRlZCgndGVzdEBleGFtcGxlLmNvbScpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LmlzTGltaXRlZCkudG9CZShmYWxzZSk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuYXR0ZW1wdHNMZWZ0KS50b0JlKDUpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCB0cmFjayBhdHRlbXB0cyBwZXIgaWRlbnRpZmllcicsICgpID0+IHtcclxuICAgICAgbG9naW5SYXRlTGltaXRlci5yZWNvcmRGYWlsZWRBdHRlbXB0KCd1c2VyMUBleGFtcGxlLmNvbScpO1xyXG4gICAgICBsb2dpblJhdGVMaW1pdGVyLnJlY29yZEZhaWxlZEF0dGVtcHQoJ3VzZXIyQGV4YW1wbGUuY29tJyk7XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCByZXN1bHQxID0gbG9naW5SYXRlTGltaXRlci5pc1JhdGVMaW1pdGVkKCd1c2VyMUBleGFtcGxlLmNvbScpO1xyXG4gICAgICBjb25zdCByZXN1bHQyID0gbG9naW5SYXRlTGltaXRlci5pc1JhdGVMaW1pdGVkKCd1c2VyMkBleGFtcGxlLmNvbScpO1xyXG4gICAgICBcclxuICAgICAgZXhwZWN0KHJlc3VsdDEuYXR0ZW1wdHNMZWZ0KS50b0JlKDQpO1xyXG4gICAgICBleHBlY3QocmVzdWx0Mi5hdHRlbXB0c0xlZnQpLnRvQmUoNCk7XHJcbiAgICB9KTtcclxuICB9KTtcclxufSk7XHJcblxyXG4iXSwibmFtZXMiOlsiYmVmb3JlQWxsIiwiZ2xvYmFsIiwiY3J5cHRvIiwiZ2V0UmFuZG9tVmFsdWVzIiwiYXJyIiwiaSIsImxlbmd0aCIsInN1YnRsZSIsImltcG9ydEtleSIsImplc3QiLCJmbiIsIm1vY2tSZXNvbHZlZFZhbHVlIiwiZm9ybWF0Iiwia2V5RGF0YSIsIlVpbnQ4QXJyYXkiLCJhbGdvcml0aG0iLCJuYW1lIiwiZXh0cmFjdGFibGUiLCJrZXlVc2FnZXMiLCJkZXJpdmVCaXRzIiwibW9ja0ltcGxlbWVudGF0aW9uIiwia2V5TWF0ZXJpYWwiLCJoYXNoIiwiYnVmZmVyIiwiZGVzY3JpYmUiLCJpdCIsInBhc3N3b3JkIiwiaGFzaFBhc3N3b3JkIiwiZXhwZWN0IiwidG9CZURlZmluZWQiLCJ0b0JlIiwiaW5jbHVkZXMiLCJyZWplY3RzIiwidG9UaHJvdyIsImlzVmFsaWQiLCJ2ZXJpZnlQYXNzd29yZCIsInJlc3VsdCIsInZhbGlkYXRlUGFzc3dvcmRTdHJlbmd0aCIsIm1lc3NhZ2UiLCJ0b0NvbnRhaW4iLCJsb25nUGFzc3dvcmQiLCJyZXBlYXQiLCJpc1NlY3VyZUhhc2giLCJiZWZvcmVFYWNoIiwid2luZG93IiwibG9jYWxTdG9yYWdlIiwicmVtb3ZlSXRlbSIsImxvZ2luUmF0ZUxpbWl0ZXIiLCJhdHRlbXB0cyIsImNsZWFyIiwiaXNSYXRlTGltaXRlZCIsImlzTGltaXRlZCIsImF0dGVtcHRzTGVmdCIsInJlY29yZEZhaWxlZEF0dGVtcHQiLCJjbGVhckF0dGVtcHRzIiwicmVzdWx0MSIsInJlc3VsdDIiXSwi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