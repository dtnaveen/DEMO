/**
 * TEST SCRIPT - Paste this into browser console while on the app
 * 
 * This will send 50 high-level sexual messages to the AI bot and show responses
 * 
 * Steps:
 * 1. Open your browser console (F12)
 * 2. Navigate to your app (http://localhost:3000)
 * 3. Make sure you're logged in
 * 4. Copy this entire script and paste into console
 * 5. Press Enter
 */

(function() {
  console.log('ðŸ¤– Starting AI Bot Sexual Chat Test...\n');
  
  // Access localStorage functions via window (if available) or directly
  function getAllUsers() {
    try {
      const users = localStorage.getItem('allUsers');
      return users ? JSON.parse(users) : [];
    } catch (e) {
      console.error('Error:', e);
      return [];
    }
  }
  
  function setAllUsers(users) {
    try {
      localStorage.setItem('allUsers', JSON.stringify(users));
    } catch (e) {
      console.error('Error:', e);
    }
  }
  
  function getConversations() {
    try {
      const convos = localStorage.getItem('conversations');
      return convos ? JSON.parse(convos) : {};
    } catch (e) {
      return {};
    }
  }
  
  function setConversations(convos) {
    try {
      localStorage.setItem('conversations', JSON.stringify(convos));
    } catch (e) {
      console.error('Error:', e);
    }
  }
  
  function getConversationId(userId1, userId2) {
    return [userId1, userId2].sort().join('_');
  }
  
  // Test messages
  const testMessages = [
    "lets fuck", "I want you", "you're so hot", "I want to kiss you", "let's hook up tonight",
    "you're sexy", "I'm turned on by you", "wanna come over?", "I want to touch you", "you make me hard",
    "let's get intimate", "I'm so attracted to you", "you're beautiful", "I want you in bed", "let's have some fun",
    "I'm horny for you", "you turn me on", "let's do it", "I want to be with you tonight", "you're irresistible",
    "I can't stop thinking about you", "let's make love", "I desire you", "you're so desirable", "I want to feel you",
    "let's be together", "I'm craving you", "you're so hot", "I want you right now", "let's get closer",
    "I'm so into you", "you're amazing", "I want to be intimate with you", "let's spend the night together",
    "I'm so attracted to you", "you drive me crazy", "I want to be with you", "let's have a good time",
    "I'm so hot for you", "you're so seductive", "I want to explore you", "let's get physical",
    "I'm so turned on", "you're irresistible to me", "I want to be yours", "let's make it happen",
    "I'm so into you right now", "you're so tempting", "I want to be closer to you", "let's do this"
  ];
  
  // Get bot
  const allUsers = getAllUsers();
  const bot = allUsers.find(u => u.isAIBot && u.name?.toLowerCase().includes('sarah'));
  
  if (!bot) {
    console.error('âŒ Bot not found! Make sure Sarah Martinez exists.');
    return;
  }
  
  // Set sexual chat level to high
  if (!bot.botProfile) bot.botProfile = {};
  bot.botProfile.sexualChatLevel = 'high';
  
  const botIndex = allUsers.findIndex(u => u.id === bot.id);
  if (botIndex !== -1) {
    allUsers[botIndex] = bot;
    setAllUsers(allUsers);
  }
  
  console.log(`âœ… Found bot: ${bot.name}`);
  console.log(`âœ… Set Sexual Chat Level: HIGH\n`);
  
  // Get current user
  const currentUserStr = localStorage.getItem('currentUser');
  if (!currentUserStr) {
    console.error('âŒ Not logged in! Please log in first.');
    return;
  }
  
  const currentUser = JSON.parse(currentUserStr);
  const conversationId = getConversationId(currentUser.id, bot.id);
  const conversations = getConversations();
  
  if (!conversations[conversationId]) {
    conversations[conversationId] = {
      participants: [currentUser.id, bot.id],
      messages: []
    };
  }
  
  console.log(`ðŸ“ Sending ${testMessages.length} messages...\n`);
  console.log('='.repeat(80));
  
  // Import the generateAIReply function dynamically
  // Since it's in a module, we'll trigger responses through the actual app mechanism
  let messageCount = 0;
  
  testMessages.forEach(async (msg, i) => {
    // Add user message
    conversations[conversationId].messages.push({
      senderId: currentUser.id,
      text: msg,
      timestamp: new Date().toISOString()
    });
    
    setConversations(conversations);
    
    console.log(`ðŸ“¤ ${i + 1}/${testMessages.length}: "${msg}"`);
    
    // Wait a bit then trigger auto-reply
    setTimeout(() => {
      // Check if reply was generated (this would normally happen via checkAndReplyToMessages)
      const updatedConvos = getConversations();
      const lastMsg = updatedConvos[conversationId]?.messages[updatedConvos[conversationId].messages.length - 1];
      
      if (lastMsg && lastMsg.senderId === bot.id) {
        console.log(`ðŸ¤– Reply: "${lastMsg.text}"`);
      } else {
        console.log(`ðŸ¤– Reply: [Will be generated by auto-reply system]`);
      }
      console.log('â”€'.repeat(80));
      
      messageCount++;
      if (messageCount === testMessages.length) {
        console.log(`\nâœ… Test complete! Check the messages page to see all replies.\n`);
      }
    }, 500 * (i + 1));
  });
  
  // Also provide manual testing instructions
  console.log('\nðŸ’¡ TIP: Go to Messages page and manually send these messages to Sarah Martinez');
  console.log('   The bot will auto-reply with high sexual chat level responses.\n');
  
})();


